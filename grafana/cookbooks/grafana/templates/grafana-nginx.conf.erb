#
# This file was generated by Chef for <%= node['fqdn'] %>.
# Do not modify this file by hand!
#

upstream grafana {
  server 127.0.0.1:<%= @grafana_port %>;
}

server {
  listen                <%= "#{@listen_address}:" if !@listen_address.nil? && !@listen_address.empty? %><%= @listen_port %>;

  server_name           <%= @server_name %> <%= @server_aliases.join(" ") %>;
  access_log            /var/log/nginx/<%= @server_name %>.access.log;

  location / {
    <% if node['grafana']['nginx']['auth_basic'] %>
    auth_basic            'Restricted';
    auth_basic_user_file  <%= node['grafana']['nginx']['httpasswd_file'] %>;
    proxy_set_header X-WEBAUTH-USER $remote_user;
    <% end %>
    proxy_pass http://grafana;
  }
}
